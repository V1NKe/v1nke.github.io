<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>CVE-2010-3333 | V1NKe的心情垃圾桶</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="CVE," />
  

  <meta name="description" content="CVE-2010-3333">
<meta name="keywords" content="CVE">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2010-3333">
<meta property="og:url" content="http://yoursite.com/2018/10/29/CVE-2010-3333/index.html">
<meta property="og:site_name" content="V1NKe的心情垃圾桶">
<meta property="og:description" content="CVE-2010-3333">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/68909CFF-A185-4946-AE12-CBA9D30AB9D8.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/CC101937-A722-4EB3-B3F0-6B50C76FA45D.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/5576CF42-1A96-48A9-9CB5-D9233CD3C336.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/5BC265D9-C39B-4966-81D6-0D0D6FE98163.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/E886E8FC-A737-4D81-99FC-D5487D89C955.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/78DD5735-5210-4110-BBAE-5A40DB757437.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/5427C8C3-16C6-44AC-958B-B21604DE4299.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/5E84805D-7524-4996-8EF8-981391B961A1.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/9DB96E35-FDD9-4E9B-AEF5-CE7C7085EF29.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/EC5499AB-0D6D-4C6C-A1D2-D9A2A06FEABF.png">
<meta property="og:image" content="http://yoursite.com/CVE-2010-3333/FD320C87-068B-49E6-BCB4-C959FE6DB27C.png">
<meta property="og:updated_time" content="2018-10-29T14:33:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CVE-2010-3333">
<meta name="twitter:description" content="CVE-2010-3333">
<meta name="twitter:image" content="http://yoursite.com/CVE-2010-3333/68909CFF-A185-4946-AE12-CBA9D30AB9D8.png">

  

  
    <link rel="icon" href="/haimian.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言-："><span class="toc-text">前言 ：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正文-："><span class="toc-text">正文 ：</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-CVE-2010-3333" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">CVE-2010-3333</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2018.10.29</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>V1NKe</span>
        </span>
      

      


      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="前言-："><a href="#前言-：" class="headerlink" title="前言 ："></a>前言 ：</h2><p>晚上本来还想搞一下阿里旺旺的那个栈溢出的，但是原先研究过一遍的cve今天还是出了些问题来着，所以说还是重新来了一遍。</p>
<h2 id="正文-："><a href="#正文-：" class="headerlink" title="正文 ："></a>正文 ：</h2><p>直接把poc拖到word上，附加上进程，发现程序崩溃在：</p>
<p><img src="/CVE-2010-3333/68909CFF-A185-4946-AE12-CBA9D30AB9D8.png" alt="68909CFF-A185-4946-AE12-CBA9D30AB9D8"></p>
<p>在此下断点，重新运行，查看一下edi和esi寄存器各自所存的内容：</p>
<p><img src="/CVE-2010-3333/CC101937-A722-4EB3-B3F0-6B50C76FA45D.png" alt="CC101937-A722-4EB3-B3F0-6B50C76FA45D"></p>
<p>可以看到esi中疑似垃圾数据，在和十六进制形式的poc文件做一下对比：</p>
<p><img src="/CVE-2010-3333/5576CF42-1A96-48A9-9CB5-D9233CD3C336.png" alt="5576CF42-1A96-48A9-9CB5-D9233CD3C336"></p>
<p>与选中的数据刚好一致，所以可以发现漏洞点在此处，此处可以自行构造payload。且此时ecx的值也与当中的acc一致，所以可以猜测acc8就是复制的次数。栈回溯看看调用它的函数：</p>
<p><img src="/CVE-2010-3333/5BC265D9-C39B-4966-81D6-0D0D6FE98163.png" alt="5BC265D9-C39B-4966-81D6-0D0D6FE98163"></p>
<p>这里的坑点找了很久，ub和u的区别就是b，这里的b可以看作back，相当于显示前面部分的汇编代码，u就是单纯的显示汇编代码，从当前开始往后显示，uf是显示该函数所有汇编代码。而这里调用函数基本是ub的最后一个代码段就是调用函数了。所以此处的调用函数是<code>0x30f4cc5d</code>，在<code>0x30f4cc5d</code>下断点，重新运行程序：</p>
<p>单步步过（p）：</p>
<p><img src="/CVE-2010-3333/E886E8FC-A737-4D81-99FC-D5487D89C955.png" alt="E886E8FC-A737-4D81-99FC-D5487D89C955"></p>
<p>运行到此处，单步步入（t）：</p>
<p><img src="/CVE-2010-3333/78DD5735-5210-4110-BBAE-5A40DB757437.png" alt="78DD5735-5210-4110-BBAE-5A40DB757437"></p>
<p>随后就进入到了所在的溢出点的地方了。整个执行流程是清除了，来看看溢出的流程，往下走（得换一个不能使得程序崩溃的文件才能继续执行）：</p>
<p><img src="/CVE-2010-3333/5427C8C3-16C6-44AC-958B-B21604DE4299.png" alt="5427C8C3-16C6-44AC-958B-B21604DE4299"></p>
<p>框住的为返回地址，箭头为执行完后esp所指向的地址，往下：</p>
<p><img src="/CVE-2010-3333/5E84805D-7524-4996-8EF8-981391B961A1.png" alt="5E84805D-7524-4996-8EF8-981391B961A1"></p>
<p>跳转了一处，随后又pop了一下，继续往下：</p>
<p><img src="/CVE-2010-3333/9DB96E35-FDD9-4E9B-AEF5-CE7C7085EF29.png" alt="9DB96E35-FDD9-4E9B-AEF5-CE7C7085EF29"></p>
<p>又pop了几处，然后leave，ret返回地址为<code>0x7ffa4512</code>，此样本为我修改过后的，这个地址是<code>jmp esp</code>的地址，第二个方框为执行完指令后esp所指向的地址。往后就是弹方框的shellcode了。所以就可以根据上面的执行流程来构造出我们想要的payload了。需要改动的地方就那么几处。注意的点就是<code>jmp esp</code>往后的地址需要填充0，不然会执行不了程序，具体的原因我也不清除，可能是污染了后面的元素吧。改动后的恶意文档：</p>
<p><img src="/CVE-2010-3333/EC5499AB-0D6D-4C6C-A1D2-D9A2A06FEABF.png" alt="EC5499AB-0D6D-4C6C-A1D2-D9A2A06FEABF"></p>
<p>这里还得了解一下rtf文档的格式标准：</p>
<p><a href="RTF 格式文档参考 http://www.doc88.com/p-33279717171.html">具体参考</a></p>
<p>再来看看后面所执行到的函数栈：</p>
<p><img src="/CVE-2010-3333/FD320C87-068B-49E6-BCB4-C959FE6DB27C.png" alt="FD320C87-068B-49E6-BCB4-C959FE6DB27C"></p>
<p>只有20栈空间，所以复制足够多就能覆盖掉返回地址。</p>

    
  </div>

  
      <div class="git"></div>
  

</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持v1nke</div>
        <ul>
        
          <li class="item">
            <span>微信扫一扫</span>
            <img src="/images/qr-wechat.jpeg" alt="">
          </li>
        
          <li class="item">
            <span>支付宝扫一扫</span>
            <img src="/images/qr-wechat.jpeg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2018/10/28/CVE-2011-0104/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2018/11/02/ActiveX控件imageMan.dll栈溢出/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    
    

    
    

    

    
    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
